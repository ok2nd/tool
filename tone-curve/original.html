<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="PhotoshopやGIMPのトーンカーブのようなjQueryプラグイン">
    <title>jquery.iocurve - PhotoshopやGIMPのトーンカーブのようなjQueryプラグイン</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/styles/github.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/rangeslider.js@2.3.3/dist/rangeslider.css">
    <link rel="stylesheet" href="css/index.css">
</head>
<body>

<header>
    <div class="bg"></div>
    <h1>jquery.iocurve</h1>
    <small>TONE CURVE UI COMPONENT</small>
</header>

<main>

    <section id="intro" class="intro">
        <h1>はじめに</h1>
        <p>jQuery プラグイン <b>jquery.iocurve</b> のページへようこそ。</p>
        <p>これはPhotoshopやGIMPなど画像加工ソフトによくある「トーンカーブ」のようなGUI部品です。</p>
        <p>曲線に沿った、指定範囲の数値列を生成します。</p>
        <p>以下は 0 ～ 255 の整数を生成する例です。制御点をマウスでつかんで動かしてみてください。</p>
        <div class="iocurve">
            <div class="input"></div>
            <div class="curve">
                <div data-option='{
                    "anchor": {
                        "points": [ [0, 0], [127, 160], [255, 255] ]
                    }
                }'></div>
            </div>
            <div class="output"></div>
        </div>
    </section>

    <section id="requirements">
        <h1>必要条件</h1>
        <ul>
            <li>HTML5 Canvas</li>
            <li>jQuery 2+</li>
        </ul>
    </section>

    <section id="browsers">
        <h1>確認ブラウザ</h1>
        <ul>
            <li>
                Windows 10
                <ul>
                    <li>Chrome 84+</li>
                    <li>Firefox 79+</li>
                    <li>Edge 44+</li>
                    <li>IE 10+</li>
                </ul>
            </li>
        </ul>
    </section>

    <section id="usage">
        <h1>使い方</h1>
        <pre><code class="hljs html">&lt;div class="iocurve" style="width:300px"&gt;&lt;/div&gt;

&lt;script src="https://code.jquery.com/jquery-2.2.4.min.js"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/gh/cmiz/jquery.iocurve@0.0.6/dist/jquery.iocurve.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
var $curve = $('.iocurve');
var option = {
    // オプション
};
$curve.on('output', function(ev, data){
    // 出力データ
    console.log(data);
});
$curve.iocurve(option);
&lt;/script&gt;</code></pre>
    </section>

    <section id="options">
        <h1>オプション</h1>
        <pre><code class="hljs js">var option = {
    x: [0, 100],
    y: [0, 100]
};
var $curve = $('.iocurve').iocurve(option);</code></pre>
        <div class="table">
            <table>
                <tr>
                    <th>キー</th>
                    <th>既定値</th>
                    <th class="desc">説明</th>
                    <th>指定例</th>
                </tr>
                <tr>
                    <td>x</td>
                    <td class="code"><pre><code class="hljs js">[0, 255]</code></pre></td>
                    <td>X軸＝入力の数値範囲を指定します。</td>
                    <td class="code" rowspan="3"><pre><code class="hljs js">x: [-1, 1],
y: [-100, 100],
dx: 0.01</code></pre></td>
                </tr>
                <tr>
                    <td>y</td>
                    <td class="code"><pre><code class="hljs js">[0, 255]</code></pre></td>
                    <td>Y軸＝出力の数値範囲を指定します。</td>
                </tr>
                <tr>
                    <td>dx</td>
                    <td class="code"><pre><code class="hljs js">1</code></pre></td>
                    <td>
                        入力値の分解幅を指定します。<br>
                        既定値 1 は、入力範囲 0 ～ 255 を [ 0, 1, 2, 3 ... 254, 255 ] の 256 個に分解することを意味します。<br>
                        入力値の個数はそのまま出力値の個数となります。</td>
                </tr>
                <tr>
                    <td>y0</td>
                    <td class="code"><pre><code class="hljs js">0</code></pre></td>
                    <td>Y軸の見た目上の正負の堺をどこに置くか数値で指定します。</td>
                    <td class="code"><pre><code class="hljs js"></code></pre></td>
                </tr>
                <tr>
                    <td>curvature</td>
                    <td class="code"><pre><code class="hljs js">0.3</code></pre></td>
                    <td>曲率を 0 ～ 0.5 で指定します。0 は直線です。</td>
                    <td class="code"><pre><code class="hljs js">curvature: 0.1</code></pre></td>
                </tr>
                <tr>
                    <td>className</td>
                    <td class="code"><pre><code class="hljs js">''</code></pre></td>
                    <td>全体を包む&lt;div&gt;要素のクラス名を指定します。</td>
                    <td class="code"><pre><code class="hljs js">className: 'iocurve'</code></pre></td>
                </tr>
                <tr>
                    <td>css</td>
                    <td class="code"><pre><code class="hljs js">{
    position: 'relative',
    margin: '20px'
}</code></pre></td>
                    <td>全体を包む&lt;div&gt;要素のCSSを指定します。</td>
                    <td class="code"><pre><code class="hljs js">css: {
    margin: '0'
}</code></pre></td>
                </tr>
                <tr>
                    <td>canvas</td>
                    <td class="code"><pre><code class="hljs js">{
    height: '100%',
    fillStyle: '#fff',
    css: {
        display: 'block',
        boxShadow: '0 0 3px #000'
    }
}</code></pre></td>
                    <td>
                        キャンバス(&lt;canvas&gt;要素)の高さ、色、CSSを指定します。<br>
                        <br>
                        高さは％か数値(px)で指定します。％は横幅に対する割合で、100%は正方形です。
                    </td>
                    <td class="code"><pre><code class="hljs js">canvas: {
    height: 300,
    css: {
        boxShadow: 'none'
    }
}</code></pre></td>
                </tr>
                <tr>
                    <td>grid</td>
                    <td class="code"><pre><code class="hljs js">{
    visible: true,
    strokeStyle: 'rgba(0, 0, 0, 0.2)'
}</code></pre></td>
                    <td>補助目盛線の表示ON/OFFと線の色を指定します。</td>
                    <td class="code"><pre><code class="hljs js">grid: { visible: false }</code></pre></td>
                </tr>
                <tr>
                    <td>anchor</td>
                    <td class="code"><pre><code class="hljs js">{
    points: [ [0, 0], [255, 255] ],
    tagName: 'a',
    className: 'anchor',
    css: {
        position: 'absolute',
        display: 'block',
        width: 18,
        height: 18,
        borderRadius: '50%',
        border: '1px solid rgba(0, 0, 0, 0.5)',
        background: 'rgba(255, 255, 255, 0.5)',
        boxSizing: 'border-box',
        cursor: 'move',
        transform: 'translate(-50%, -50%)'
    }
}</code></pre></td>
                    <td>
                        アンカー（制御点）の初期座標値 [X, Y] の配列と、アンカー要素のCSSを指定します。<br>
                        <br>
                        アンカーの初期座標値は必ず先頭と末尾の2点以上をセットし、値はXY範囲内（既定の場合は0-255）とします。<br>
                        また先頭と末尾のX座標を、X軸の範囲の下限と上限に一致させます。たとえばX座標が [0, 100] の場合、先頭アンカーX座標を 0 、末尾アンカーX座標を 100 とします。<br>
                    </td>
                    <td class="code"><pre><code class="hljs js">anchor: {
    points: [
        [-1, -100],
        [0, 0],
        [1, 100]
    ]
}</code></pre></td>
                </tr>
                <tr>
                    <td>bar</td>
                    <td class="code"><pre><code class="hljs js">{
    visible: true,
    fillStyle: {
        positive: 'rgba(0, 100, 70, 0.2)',
        negative: 'rgba(150, 30, 70, 0.2)'
    }
}</code></pre></td>
                    <td>出力値の棒グラフ</td>
                    <td class="code"><pre><code class="hljs js"></code></pre></td>
                </tr>
                <tr>
                    <td>plot</td>
                    <td class="code"><pre><code class="hljs js">{
    visible: false,
    strokeStyle: '#f00'
}</code></pre></td>
                    <td>出力値の散布プロット</td>
                    <td class="code"><pre><code class="hljs js"></code></pre></td>
                </tr>
                <tr>
                    <td>histogram</td>
                    <td class="code"><pre><code class="hljs js">{
    data: null,
    fillStyle: '#ddd'
}</code></pre></td>
                    <td>
                        背景ヒストグラム<br>
                        <br>
                        data にヒストグラム数値配列を指定します。配列要素数は出力値と同数、各数値は0～1の実数とします。
                    </td>
                    <td class="code"><pre><code class="hljs js"></code></pre></td>
                </tr>
                <tr>
                    <td>controlPoint</td>
                    <td class="code"><pre><code class="hljs js">{
    visible: false,
    strokeStyle: '#00f'
}</code></pre></td>
                    <td>曲線補間の制御点と接線</td>
                    <td class="code"><pre><code class="hljs js"></code></pre></td>
                </tr>
            </table>
        </div>
    </section>

    <section id="events">
        <h1>イベント</h1>
        <div class="table">
            <table>
                <tr>
                    <th>name</th>
                    <th class="desc">説明</th>
                    <th>コード</th>
                </tr>
                <tr>
                    <td>anchors</td>
                    <td>
                        アンカーが作成・変更された時に発火します。全アンカー情報を取得します。<br>
                        <b class="caution">※コールバック引数 $anchors は読み取り専用です。編集しないでください。</b>
                    </td>
                    <td class="code"><pre><code class="hljs js">$curve.on('anchors', function( ev, $anchors ){
    // $anchors is jQuery object of all anchor elements.
    // <b class="caution">Caution: Do not modify $anchors. It is read-only. Because it is a managed object inside the plugin.</b>
    $anchors.each(function() {
        // $(this) is one anchor.
    });
});</code></pre></td>
                </tr>
                <tr>
                    <td>anchor</td>
                    <td>アンカー入力が発生した時に発火します。入力中のアンカー1つの情報を取得します。</td>
                    <td class="code"><pre><code class="hljs js">$curve.on('anchor', function( ev, anchor ){
    // anchor.element   anchor DOM element
    // anchor.kind      'new'|'move'|'remove'
    // anchor.x         coordinate X
    // anchor.y         coordinate Y
});</code></pre></td>
                </tr>
                <tr>
                    <td>output</td>
                    <td>出力値が更新された時に発火します。</td>
                    <td class="code"><pre><code class="hljs js">$curve.on('output', function( ev, data ){
    // data is array of output values.
});</code></pre></td>
                </tr>
            </table>
        </div>
    </section>

    <section id="methods">
        <h1>メソッド</h1>
        <div class="table">
            <table>
                <tr>
                    <th>name</th>
                    <th class="desc">説明</th>
                    <th>コード</th>
                </tr>
                <tr>
                    <td>data</td>
                    <td>出力値を取得します。</td>
                    <td class="code"><pre><code class="hljs js">$curve.trigger('data', [function( data ){
    // data
}]);</code></pre></td>
                </tr>
                <tr>
                    <td>option</td>
                    <td>
                        オプションを変更します。<br>
                        ただしアンカー初期座標は変更できません。
                    </td>
                    <td class="code"><pre><code class="hljs js">$curve.trigger('option', [{
    // 任意のオプション
    // ただし anchor.points は変更不可
}]);</code></pre></td>
                </tr>
                <tr>
                    <td>resized</td>
                    <td>親要素に合わせてリサイズします。</td>
                    <td class="code"><pre><code class="hljs js">$curve.trigger('resized');</code></pre></td>
                </tr>
                <tr>
                    <td>destroy</td>
                    <td>破棄します。</td>
                    <td class="code"><pre><code class="hljs js">$curve.trigger('destroy');</code></pre></td>
                </tr>
            </table>
        </div>
    </section>

    <section id="example" class="example">
        <h1>応用例</h1>

        <div class="wrap picture-edit">
            <div>
                <ul>
                    <li>写真素材を加工します</li>
                    <li>各ピクセルのRGB値をカーブの出力値に変換します</li>
                </ul>
                <div class="channel">
                    <label class="checked"><input type="radio" name="kind" value="RGB" checked>RGB</label>
                    <label><input type="radio" name="kind" value="R">R</label>
                    <label><input type="radio" name="kind" value="G">G</label>
                    <label><input type="radio" name="kind" value="B">B</label>
                </div>
                <div class="curve RGB"></div>
                <div class="curve R hide"></div>
                <div class="curve G hide"></div>
                <div class="curve B hide"></div>
            </div>
            <canvas data-src="img/sample.png"></canvas>
        </div>

        <div class="wrap">
            <ul>
                <li>出力範囲 -20 ～ 20</li>
                <li>出力値の散布プロット表示</li>
                <li>曲線補間の制御点と接線表示</li>
                <li>曲率をスライダーで変更</li>
            </ul>
            <div class="iocurve">
                <div class="input"></div>
                <div class="curve">
                    <div data-option='{
                        "x": [-20, 20],
                        "y": [-20, 20],
                        "anchor": {
                            "points": [ [-20, -20], [0, 0], [20, 20] ]
                        },
                        "histotram": {},
                        "controlPoint": {
                            "visible": true
                        },
                        "plot": {
                            "visible": true
                        }
                    }'></div>
                    <input type="range" value="0.3" min="0" max="0.5" step="0.01">
                </div>
                <div class="output"></div>
            </div>
        </div>

    </section>

    <section id="source">
        <h1>ダウンロード / ソースコード</h1>
        <a href="https://github.com/cmiz/jquery.iocurve" class="github"></a>
    </section>

    <section id="license">
        <h1>ライセンス</h1>
        <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License 2.0</a>
    </section>

</main>

<footer>
&copy; 2020 cmiz.
</footer>

<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/cmiz/jquery.iocurve@0.0.6/dist/jquery.iocurve.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/rangeslider.js@2.3.3/dist/rangeslider.min.js"></script>
<script src="js/index.js"></script>
</body>
</html>
